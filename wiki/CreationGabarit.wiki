#labels Documentation
= Création d'un nouveau plugin =

== <u>Creation du gabarit ou plugin</u> ==

<h3>Création des fichiers et des dossiers</h3>

<ul>
 <li> Commencez par vous rendre dans le dossier _plugins_ ("_nomDuProjet/include/plugins_") de votre projet.</li>
 <li> Créez-y un dossier, avec pour nom le nom de votre futur plugin(pas d'espace ni de caractère spécial). <b>Le nom du plugin doit, de préférence, être le même que celui de la table utilisée (utile pour le moteur de recherche)</b>.</li>
[http://www.opixido.com/ocms/screen/gabarit/gabarit-arbo.png]
 <li> Créez-y le fichier PHP qui va générer le gabarit (controlleur). De préférence un nom évocateur comme "genNomDuPlugin".</li>
</ul>

<h4>Le controlleur</h4>

Dans ce fichier, déclarez votre classe. La classe créée doit étendre la classe _ocmsGen_ ou la classe _ocmsPlugin_.
La fonction _init()_ et _afterInit()_ seront automatiquement appelées avant la fonction _gen()_. Elles ne doivent rien retourner et ne rien afficher.
La fonction _gen()_ retournera le code du gabarit/plugin à afficher.

<b>ATTENTION : le fichier PHP générant le gabarit doit porter le même nom que la classe déclarée et aucune fonction ne doit porter le même nom que la classe</b>

Créez dans la classe les fonctions _init()_ (facultatif) et _gen()_.

Vous devriez obtenir quelque chose comme :
<code>
class genTest extends ocmsGen
{
 public function init() {
  //Do something
 }
 public function gen() {
  //Return something
 }
}
</code>

<h4>Le modèle</h4>

 * Créez un fichier PHP _front.php_ dans le dossier courant (_include/plugins/nomDeVotrePlugin_). Ce fichier sera automatiquement inclu. Vous pourrez y déclarer vos classes utiles au fonctionnement du plugin.

 * Vous y déclarerez vos classes utiles au plugin. Chaque classe utilisant la base de données devra étendre la classe _row_.

<code>
class maClasse extends row
{
 //Constructeur
 function __construct( $roworid) {
  parent::__construct('nomTable', $roworid);
 }

 function getTitle() {
  return 'Hello world !';
 }
}
</code>

==== La vue ====

Pour intégrer la vue au controlleur, veuillez procéder comme suit :

 * Créez dans le dossier courant un dossier qui va contenir le template du gabarit (_tpl_ par exemple).
 * Créez dans le nouveau dossier le template PHP (_nomDuPlugin.php_ par exemple)
 * Pour implémenter la vue dans le controller, vous devrez déclarer un objet de type _genTemplate_ et lui associer le template précédemment créé.
<code>
public function gen(){
 //Déclaration du nouveau template
 $tpl = new genTemplate;
 //Affectation du template. Attention : ne pas rajouter l'extension au nom du template lors du chargement
 $tpl->loadTemplate('nomDuTemplate', 'plugins/nomDuPlugin/cheminVersTemplate');

 //On retourne le template généré
 return $tpl->gen();
}
</code>
Documentation de la classe genTemplate [Classes ici].

==== Mise en place de la configuration BO/FO ====

 * Crééz un fichier _config.php_ qui sera automatiquement inclu.

[GabaritBO Plus de détails ici]


<h4>Arborescence finale</h4>

[http://www.opixido.com/ocms/screen/gabarit/gabarit-arbo2.png]


== <u>Installation du gabarit ou du plugin</u> ==

<h3>Enregistrement dans la table "s_gabarit"</h3>

Deux méthodes sont possibles : 

 * Directement dans le système de gestion de BD :

  # Dans la table "s_gabarit" de votre base de données, créez une nouvelle ligne.
  # Insérez les champs suivants :
|| _ gabarit_id _ || _ gabarit_titre _ || ... || _ gabarit_classe _ || ... || _ gabarit_plugin _ ||
|| ... || titre du gabarit || ... || titre de la classe || ... || nom du dossier ||

 * A partir du Back-Office
  # Ajouter le paramètre "&curTable=s_gabarit" à la fin de l'url
  # Cliquez sur "Ajouter un élément"
  # Renseignez le titre du gabarit/plugin, le nom de la classe, des paramètres (facultatif), et le nom du dossier contenant le gabarit/plugin.


<h3>Installer le plugin</h3>

 * Rendez-vous sur la page d'administration de votre site 
 * Cliquez sur le lien "Plugins" dans "Dev".
 * Sélectionnez "Ajouter un élément", sélectionnez votre nouveau plugin, puis enregistrez. Cliquez ensuite sur "Installer".

<h3>Attribuer un gabarit à une page</h3>

 * Rendez-vous dans la gestion du contenu et sélectionnez la page où vous souhaitez insérer votre nouveau gabarit.
 * Cliquez sur "Modifer"
 * Dans l'onglet "Paramètres", sélectionnez votre nouveau gabarit (champ "gabarit spécial"), puis enregistrez et validez.