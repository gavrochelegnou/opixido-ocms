#labels Documentation
= Création d'un nouveau gabarit de page =

== Mise en place ==

=== Création des dossiers et fichiers PHP ===

 * Commencez par vous rendre dans le dossier "plugins" (nomDuProjet/include/plugins) de votre projet

 * Créez-y un dossier, avec pour nom le nom de votre futur plugin(pas d'espace ni de caractère spécial)
 * Créez-y le fichier PHP qui va générer le gabarit. De préférence un nom évocateur comme "genNomDuPlugin".
  # Dans ce fichier, déclarez votre classe ("genNomDuPlugin")
  # *ATTENTION : le fichier PHP générant le gabarit doit porter le même nom que la classe déclarée. Aucune fonction ne doit porter le même nom que la classe*
  # Créez dans la classe les fonctions init() (facultatif) et gen()

 * Créez un fichier PHP front.php qui sera automatiquement parcouru. Vous pourrez y déclarer vos classes utiles au fonctionnement du plugin.

 * Créez, toujours dans le même dossier, un dossier qui va contenir le template du gabarit ("tpl" par exemple).
 * Créez dans le dossier "tpl" le template PHP ("nomDuPlugin.php" par exemple)

[http://www.opixido.com/ocms/screen/gabarit/gabarit-arbo.png]

=== Insertion dans la base de données ===

 * Dans la table "s_gabarit" de votre base de données, créez une nouvelle ligne.

 * Insérez les champs suivants :
|| _ gabarit_id _ || _ gabarit_titre _ || ... || _ gabarit_classe _ || ... || _ gabarit_plugin _ ||
|| ... || titre du gabarit || ... || titre de la classe || ... || nom du dossier ||

=== Ajouter le gabarit dans une rubrique ===

 * Rendez-vous sur la page d'administration de votre site (monSite/admin)
 * Cliquez sur le lien "Plugins" dans "Dev".
 * Sélectionnez "Ajouter un élément", sélectionnez votre nouveau plugin, puis enregistrez. Cliquez ensuite sur "Installer".
 * Rendez-vous ensuite dans la gestion du contenu et sélectionnez la page où vous souhaitez insérer votre nouveau gabarit.
 * Cliquez sur "Modifer"
 * Dans l'onglet "Paramètres", sélectionnez votre nouveau gabarit (champ "gabarit spécial"), puis enregistrez et validez.


=== La configuration ===

 * Créez dans le dossier de votre plugin le fichier PHP "config.php".
  ( C'est dans ce fichier que vous configurerez l'affichage et la gestion du plugin dans le back-office )
 * 



== Un exemple : Actualités == 

Nous allons voir dans cet exemple comment créer un gabarit simple mais très utile : les actualités.

 === Création du dossier et des fichiers ===

 * Commencez par créer un dossier ("actualites" par exemple) dans le dossier des plugins.
 * Ajoutez dans ce dossier créé un fichier PHP nommé "genActualites".
 * Créez-y une classe genActualites héritant de la classe ocmsGen (class genActualites extends ocmsGen {})
  # ...
 * Créez ensuite dans le dossier de votre plugin :
  # un fichier "front.php" (contiendra la classe Actualite)
  # un fichier "config.php" (fichier de config pour le back-office)
  # un dossier "tpl" (contient le template)
  # dans le dossier "tpl", un template "actualites.php"
  # un dossier "forms"
  # dans le dossier "forms", un fichier "actualites.forms.php" (contient les champs de la table à remplir dans le BO)

Vous devriez obtenir cette arborescence :

[http://www.opixido.com/ocms/screen/gabarit/gabarit-arbo-actualites.png]

 ...



=== Insertion du gabarit dans la base de données ===

 * Insérer dans la table s_gabarit une ligne : 
|| gabarit_titre || gabarit_classe || gabarit_plugin ||
|| Actualités || genActualites || actualites ||

=== Ajouter le gabarit dans une rubrique ===

[http://www.opixido.com/ocms/screen/gabarit/gabarit-actus.png]

=== Création de la table actualités ===

 * Créez une nouvelle table (exemple : "a_actualite")
 * Ajoutez ses attributs : 
  # Un identifiant : "actualite_id" (INT (11) en auto-incrémente)
  # Le nom de l'actualité : "actualite_nom_fr" (VARCHAR) (ajoutez de même "actualite_nom_en" pour la version anglaise. Plus d'infos sur la gestion multilingue [http://code.google.com/p/opixido-ocms/wiki/GestionLangues ici])
  # Le contenu de l'actualité : "actualite_contenu_fr" (TEXT)
  # Une image ! "actualite_img" (VARCHAR)
  # Une date : "actualite_date" (DATETIME)
  # Un booléen pour la mise en ligne : "en_ligne" (TINYINT(1))

|| <u>actualite_id</u> || INT(11), auto-incremente ||
|| actualite_titre_fr || VARCHAR(250) ||
|| actualite_titre_en || VARCHAR(250) ||
|| actualite_contenu_fr || TEXT ||
|| actualite_contenu_en || TEXT ||
|| actualite_img || VARCHAR(250) ||
|| actualite_date || DATETIME ||
|| en_ligne || TINYINT(1) ||

Les types de champs et attributs générés automatiquement par OCMS sont listés [http://code.google.com/p/opixido-ocms/wiki/configurationBO sur cette page]

=== Création du template de la liste des actualités ===

 * Ouvrez votre template actualites.php qui se trouve dans le dossier "tpl"
 * Introduisez-y votre code HTML et vos variables ( sous la forme @@maVariable@@ )
  # Si vous souhaitez boucler un bloc, placez celui-ci entre une balise XML : <ACTUALITE>`<div>Votre code</div>`</ACTUALITE>
 * Voici à quoi devrait finalement ressembler votre template :
[http://www.opixido.com/ocms/screen/gabarit/gabarit-actualites-template.png]
  
===  ===