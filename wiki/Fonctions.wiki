#labels Documentation
= Fonctions =

== Urls ==

 * Récupérer l'url du serveur :
<code>getServeurUrl();</code>

 * Récupérer l'identifiant de la rubrique du gabarit correspondant
<code>getRubFromGabarit('genActualites')</code>

 * Récupérer l'identifiant de la première rubrique qui a comme gabarit la classe passée en paramètre
<code>getRubriqueByGabarit('genActualites')</code>

 * Récupérer l'url d'une rubrique ayant pour gabarit 'genActualites' :
<code>
//Récupère l'url de la rubrique ayant pour gabarit 'genActualites'
getUrlFromId(getRubFromGabarit('genActualites'));
//Récupère l'url précédente, en y rajoutant des paramètres :
LG étant une constante récupérant le code de la langue actuelle, et actu un paramètre
getUrlFromId(getRubFromGabarit('genActualites'), LG, array('actu'=>5));
</code>

== Gestion des erreurs ==

Vous pouvez utiliser la fonction _debug()_  ou _error()_pour afficher du contenu dans une infobulle;
<code>
//Affichera simplement "TEST"
derror('TEST');
//Affichera 'TEST' puis la liste des fichiers inclus et des appels aux fonctions
debug('TEST');
//Idem que debug()
error('TEST');
//Afficher une infobulle verte
dinfo('TEST');
</code>

== Fichiers ==

=== Images ===

 * Récupérer l'url complet d'une image :
<code>
//function getImg(table, champ, id, row)
getImg('a_actualite', 'actualite_img', $idActu, '');
//Equivaut à :
$actu = new row('a_actualite',$idActu);
$actu->actualite_img;
</code>

 * Récupérer l'url d'une image en _Thumbnail_ :
<code>
//function getThumb($table, $champ, $id, $row = array(), $w, $h)
//Vous pouvez ne pas spécifier la hauteur en mettant 0
getThumb('a_actualite', 'actualite_img', $idActu, '', 300, 400);
</code>

 * Récupérer l'url d'une image en _Crop_ :
<code>
//function getCrop($table, $champ, $id, $row = array(), $w, $h)
getCrop('a_actualite', 'actualite_img', $idActu, '', 300, 400);
//Vous pouvez ne pas spécifier la hauteur en mettant 0
</code>


== Contenu ==

 * Limiter le nombre de mots et rajouter une chaine
<code>
//function limitWords($str, $nbwords = 30, $tpp = ' ...')
echo limitWords($str, 50, '...');
</code>

 * Limiter le nombre de caractères et rajouter "..."
<code>
//function limit($str, $nchars = 30)
echo limit($str, 50);
</code>

== E-Mails et formulaires ==

 * Vérifier la validitié d'un mail :
<code>
CheckEmail('email@opixido.com');
//Equivaut à :
isMail('email@opixido.com');
</code>

 * Envoyer un mail
<code>sendMail($to, $subject, $message, $headers)</code>

 * Déterminer si le fichier est une image 
<code>isImage($str);</code>


== Base de données ==

<h3>Pré-requis</h3>
Vous devez configurer la connexion à la base de données dans le fichier _config.server.php_ se situant dans le dossier _include/config/_ :

<code>
$_bdd_user = 'root';
$_bdd_pwd = '';
$_bdd_bdd = 'database';
$_bdd_host = 'localhost';
$_bdd_type = 'mysql';
</code>

OCMS utilise les fonctions de la librairie PHP ADOdb pour se connecter au SGBD.

<h3>Les fonctions</h3>

<ul>
<li>
Exécuter une requête SQL
<code> 
/* @param string $sql
 * @param string $msg Message en cas d'erreur
 * @return ADORecordSet $res
 */
doSql($sql, $msg=''); 
</code>

Exemple :
<code>
$res = doSql(' UPDATE user SET age=30 WHERE user_id=2 ');
if($res) echo 'Réussi';
</code>

</li>

<li>
Récupérer l'ensemble des résultats d'une requête sous forme de tableau
<code>
/* @param string $sql
 * @param bool $cache
 * @param string $connexion
 * @return array
 */
getAll($sql, $cache=0, $connexion='');
</code>

Exemple :
<code>
$users = getAll(' SELECT * FROM user ');
foreach($users as $user)
{
 echo $user['nom'];
}
</code>

</li>

<li>
Récupérer le premier enregistrement d'une requête
<code>
/* @param string  $sql
 * @param bool $cache
 * @param string $connexion
 * @return array
 */
getSingle($sql, $cache=0, $connexion='');
</code>

Exemple : 
<code>
$user = getSingle(' SELECT * FROM user WHERE user_id=2 ');
echo $user['nom'];
</code>
</li>

<li>
Ajouter un paramètre dans une requête SQL
<code>
/* @param string $param
 * @param string $type int ou string
 * @return string
 */
sql($param, $type='string');
</code>

Exemple :
<code>
$user = getSingle(' SELECT * FROM user WHERE user_id = '.sql($_REQUEST['id'], 'int'));
//Valeur de retour : 'SELECT * FROM user WHERE user_id = "2" '
</code>
</li>

<li>
Récupérer un enregistrement à partir de la table et de l'identifiant de la ligne
<code>
/* @param string $table
 * @param string $type int ou string
 * @param boolean $onlyOnline
 * @return array
 */
getRowFromId($table, $id, $onlyOnline=false);
</code>

Exemple :
<code>
$row = getRowFromId('user', 2);
//Equivalent : getSingle(' SELECT * FROM user WHERE user_id = 2 ');
</code>

</li>

<li>
Ne récupérer que les champs en ligne (possédant l'attribut _"en_ligne"_)

</li>

</ul>