<h1>Ocms_search</h1>

<h2>Introduction</h2>

Il permet de créer un gabarit pour la recherche. Par défaut, la recherche s'effectue dans les rubriques et dans les tables créées pour des gabarits de page ou plugin.

<h2>Installation du plugin</h2>

[CreationGabarit#Installation_du_gabarit_ou_du_plugin Installation d'un gabarit ou d'un plugin dans le Back-Office]

<h2>Front-Office</h2>

<h3>Insertion de la barre de recherche</h3>

Pour afficher la barre de recherche dans le layout, il suffit de modifier le fichier _default.html.php_ du dossier _include/exports/_ et d'y insérer le formulaire comme ceci :
<code language="php">
<div id="recherche">

 <form id="form1" action="<?php echo getUrlFromId(getRubFromGabarit('genOcmsSearch')) ?>" method="get">

  <input type="text" placeholder="Rechercher" value=<?= alt(akev($_GET, 'q') )?> id="rechercher_input" name="q" />

  <button value="OK" id="recherche_btn"></button>
 </form>

</div>
</code>
<p>L'action doit pointer vers la rubrique ayant pour gabarit _"ocms_search"_.
La fonction _getUrlFromId(getRubFromGabarit('genOcmsSearch'))_ permet de récupérer cet url. </p>
<p>Plus d'informations sur les urls dans [Fonctions#Urls cette page].</p>

<h3>Affichage des résultats</h3>



<h3>Attributs des objets</h3>

Pour chaque objet affiché dans la liste de résultats, le moteur regarde si cet objet possède ou non les fonctions suivantes définies dans les fichiers _front.php_ ([CreationGabarit#Le_modèle modèle]) :
<ul>
<li>_getUrl()_ : retourne l'url de l'objet</li>
<li>_getImg()_ : retourne l'image de l'objet</li>
<li>_getTitle()_ : retourne le titre de l'objet</li>
<li>_getDesc()_ : retourne la description/résumé de l'objet</li>
</ul>

*Attention : il est nécessaire de nommer les classes des objets avec le nom de la table utilisée par ce dernier.
Exemple : une actualité enregistrée dans la table _"p_actualite"_ possèdera une classe "p_actualite".*

<h2>Back-Office</h2>

<h3>Indexation</h3>

<p>Le plugin a ajouté un lien "Ré-indexer le site" dans les "Actions administrateur", sur la partie droite.</p>
[http://www.opixido.com/ocms/screen/plugins/search-bo.png]
<p>Dans cette partie est affichée la liste des gabarits. Il est possible d'indexer manuellement chaque gabarit, ou alors de tout indexer en même temps en sélectionnant "Ensemble".</p>

<p>L'indexation se fait automatiquement lors de la création ou de la modification d'un élément.</p>
<p>Pour vider toute la recherche, il suffit de sélectionner, dans la page d'accueil du back-office le lien "Vider la recherche"</p>